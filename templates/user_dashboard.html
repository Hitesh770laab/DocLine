<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>DocLine – Doctor Availability</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <!-- Custom styles -->
    <link href="/static/style.css" rel="stylesheet">

    <style>
        body {
            background: linear-gradient(135deg, #e7f1ff, #f8fbff);
            min-height: 100vh;
            font-family: "Segoe UI", sans-serif;
        }

        .page-title {
            font-weight: 700;
            color: #004b8d;
        }

        .doctor-card {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            border-radius: 18px;
            padding: 25px;
            transition: 0.2s;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .doctor-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .progress {
            height: 10px;
            border-radius: 10px;
        }

        .navbar-custom {
            background: #0077c2;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>

<body>

    <!-- NAVBAR -->
    <nav class="navbar navbar-dark navbar-custom">
        <div class="container-fluid d-flex justify-content-between">

            <h3 class="text-white mb-0">
                <i class="fa-solid fa-stethoscope"></i> DocLine – Doctor Availability
            </h3>

            <a href="/" class="btn btn-light">
                <i class="fa-solid fa-right-to-bracket"></i> Admin Login
            </a>

        </div>
    </nav>

    <div class="container mt-5">

        <h2 class="page-title mb-4">
            <i class="fa-solid fa-user-doctor"></i> Live Doctor Availability
        </h2>

        <!-- Grid -->
        <div id="doctorGrid" class="row g-4"></div>

    </div>

    <script>
        // Load doctor availability from backend
        async function loadDoctorStatus() {
            const response = await fetch("/api/run_greedy", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    num_doctors: 3,
                    lam: 0.20,
                    mu: 0.08333,
                    sim_time: 120
                })
            });

            const result = await response.json();
            const data = result.result;

            const grid = document.getElementById("doctorGrid");
            grid.innerHTML = ""; // clear old data

            for (let i = 1; i <= 3; i++) {
                const wait = data.avg_wait_min.toFixed(1);
                const util = data.utilization_percent.toFixed(1);

                const utilColor =
                    util < 40 ? "bg-success" :
                        util < 70 ? "bg-warning" :
                            "bg-danger";

                const card = `
            <div class="col-md-4">
                <div class="doctor-card shadow-sm">
                    <h4 class="fw-bold">
                      <i class="fa-solid fa-user-doctor text-primary"></i>
                      Doctor ${i}
                    </h4>

                    <p class="mt-3">
                      <strong>Estimated Wait:</strong>
                      ${wait} minutes
                    </p>

                    <p>
                      <strong>Utilization:</strong>
                      ${util}%
                    </p>

                    <div class="progress mb-3">
                        <div class="progress-bar ${utilColor}" role="progressbar"
                            style="width: ${util}%;"></div>
                    </div>

                    <button class="btn btn-primary w-100">
                     <i class="fa-solid fa-calendar-plus"></i> Book Appointment
                    </button>
                </div>
            </div>
        `;

                grid.innerHTML += card;
            }
        }

        // Initial load
        loadDoctorStatus();

        // Auto-refresh every 15 seconds
        setInterval(loadDoctorStatus, 15000);
    </script>

</body>

</html>